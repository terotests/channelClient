(function(){var t={},n=function(){var n=function(){!function(t){var n,e,i,r,a;t.add=function(t,n,i){if(n||i){var r;"[object Array]"===Object.prototype.toString.call(i)?r=i:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),e.push([n,t,r])}else e.push(t)},t.asap=function(t){this.add(t)},t.every=function(t,n,e){e||(e="time"+(new Date).getTime()+Math.random(1e7)),r[e]={step:Math.floor(1e3*t),fn:n,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!n){var t,s;if(this.polyfill(),"undefined"!=typeof window){var t=window.requestAnimationFrame,s=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(n){t||(t=window[n+"RequestAnimationFrame"],s=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),s||(s=function(t){clearTimeout(t)}),e=[],i={},r={},a=[];var o=0,c=function(){for(var n,s=(new Date).getTime();n=e.shift();)"[object Array]"===Object.prototype.toString.call(n)?n[1].apply(n[0],n[2]):n();for(var f=0;f<a.length;f++){var u=a[f];u()}for(var l in i)if(i.hasOwnProperty(l)){var h=i[l];h[0](h[1]),delete i[l]}for(var l in r)if(r.hasOwnProperty(l)){var h=r[l];h.nextTime<s&&(h.fn(),h.nextTime=s+h.step),h.until&&h.until<s&&delete r[l]}t(c),o=s};c(),n=!0}}),t.once=function(t,n,e){i[t]=[n,e]},t.onFrame=function(t){a.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var n=a.indexOf(t);return n>=0?(t._onRemove&&t._onRemove(),a.splice(n,1),!0):!1}}(this)},e=function(t,n,i,r,a,s,o,c){var f,u=this;if(!(u instanceof e))return new e(t,n,i,r,a,s,o,c);var l=[t,n,i,r,a,s,o,c];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){f=t.apply(u,l)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,n,i,r,a,s,o,c)}else if(f)return f;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};e._classInfo={name:"later"},e.prototype=new n;var i=function(){!function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var n;n=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var e=n.length,i=0,a=[],s=new Array(e);return this.then(function(){var t=r();return 0==n.length&&t.resolve([]),n.forEach(function(n,r){n.then?(a.push(n),n.then(function(n){s[r]=n,i++,i==e&&t.resolve(s)},function(n){t.reject(n)})):t.reject("Not list of promises")}),t})},t.collect=function(t,n,e){var i;i=this.isArray(n)?n:[n];var a=i.length,s=!1,o=!1,c=0,f=[],u=e||{};return this.then(function(){var n=r();return i.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,s=t(e,u),(s&&!o||0==o&&a==c)&&(n.resolve(u),o=!0)},function(t){n.reject(t)})):n.reject("Not list of promises")}),n})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var n=this._childPromises.length;n--;){var e=this._childPromises.shift();if(e._onFulfill)try{var i=e._onFulfill(t);"undefined"!=typeof i?e.resolve(i):e.fulfill(t)}catch(r){e.reject(r)}else e.fulfill(t)}this._state=1,this.triggerStateChange()}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(n)&&(this._onReject=n),!n&&this.isFunction(t)){var i=this;e().asap(function(){t(function(t){i.resolve(t)},function(t){i.reject(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var n=this._childPromises.length;n--;){var e=this._childPromises.shift();if(e._onReject)try{e._onReject(t),e.reject(t)}catch(i){e.reject(i)}else e.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var n=this;t.onStateChange(function(){1==t._state&&n.resolve(t.value()),2==t._state&&n.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var e=!1;try{var n=this;t.then.call(t,function(t){e||(n.resolve(t),e=!0)},function(t){e||(n.reject(t),e=!0)})}catch(i){e||this.reject(i)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var i=new r(t,n),a=this;return 1==this._state&&e().asap(function(){a.fulfill(a.value())}),2==this._state&&e().asap(function(){a.reject(a.rejectReason())}),this._childPromises.push(i),i},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(n){n(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},r=function(t,n,e,i,a,s,o,c){var f,u=this;if(!(u instanceof r))return new r(t,n,e,i,a,s,o,c);var l=[t,n,e,i,a,s,o,c];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){f=t.apply(u,l)}),"function"==typeof f){if(f._classInfo.name!=r._classInfo.name)return new f(t,n,e,i,a,s,o,c)}else if(f)return f;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};r._classInfo={name:"_promise"},r.prototype=new i;var a=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return t instanceof Array},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){var n;t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t,e){return t&&e?(t+=e.getId(),n||(n={}),n[t]?n[t]:void(n[t]=this)):void 0}),t._createTransaction=function(){this._currentFrame={id:this.guid(),version:1,from:this._data.getJournalLine(),fail_tolastok:!0,commands:[]}},t.addCommand=function(t){this._currentFrame&&this._currentFrame.commands.push(t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n,i){if(t&&n){this._channelId=t,this._socket=n,this._options=i,this._changeFrames=[],this._pendingFrames=[],this._id=t+n.getId();var r=this;e().every(.1,function(){if(r._currentFrame&&r._currentFrame.commands.length){var e=r._currentFrame;r._pendingFrames.push(r._currentFrame),n.send("channelCommand",{channelId:t,cmd:"changeFrame",data:r._currentFrame}).then(function(t){if(t.result){var n=r._pendingFrames.indexOf(e);r._pendingFrames.splice(n,1)}}),r._createTransaction()}}),n.on("connect",function(){i.auth&&n.send("auth",{userId:i.auth.username,password:i.auth.password}).then(function(e){return e.userId?(r._userId=e.userId,r._logged=!0,n.send("requestChannel",{channelId:t})):!1}).then(function(e){return e&&e.channelId==t?(r._connected=!0,n.send("channelCommand",{channelId:t,cmd:"readBuildTree",data:""})):!1}).then(function(n){if(n){for(var e=n.pop(),i=_channelData(r._id,e,[]),a=n.pop();a;)i._journalPointer=0,i._journal.length=0,a.forEach(function(t){i.execCmd(t)}),a=n.pop();r._data=i,r._createTransaction(),r.resolve({result:!0,channelId:t})}else r.resolve({result:!1,text:"Authorization or connection failed"})})})}})}(this)},s=function(t,n,e,i,r,a,o,c){var f,u=this;if(!(u instanceof s))return new s(t,n,e,i,r,a,o,c);var l=[t,n,e,i,r,a,o,c];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){f=t.apply(u,l)}),"function"==typeof f){if(f._classInfo.name!=s._classInfo.name)return new f(t,n,e,i,r,a,o,c)}else if(f)return f;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};a.prototype=r.prototype,s._classInfo={name:"channelClient"},s.prototype=new a,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.channelClient=s,this.channelClient=s):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.channelClient=s:this.channelClient=s}.call(new Function("return this")()),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},e=function(t,n,i,r,a,s,o,c){var f,u=this;if(!(u instanceof e))return new e(t,n,i,r,a,s,o,c);var l=[t,n,i,r,a,s,o,c];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){f=t.apply(u,l)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,n,i,r,a,s,o,c)}else if(f)return f;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};e._classInfo={name:"channelClientModule"},e.prototype=new n,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());